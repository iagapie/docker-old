version: "3"

networks:
  traefik:
    external:
      name: traefik

services:
  reverse-proxy:
    container_name: reverse-proxy
    image: traefik
    command:
    - --api
    - --docker
    - --docker.domain=localhost
    - --docker.exposedByDefault=false
    - --docker.network=traefik
    - --defaultEntryPoints=http,https
    - --entryPoints=Name:http Address::80 Redirect.EntryPoint:https
    - --entryPoints=Name:https Address::443 TLS
    restart: always
    networks:
    - traefik
    ports:
    - "80:80"
    - "443:443"
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    labels:
    - "traefik.enable=true"
    - "traefik.port=8080"
    - "traefik.backend=reverse-proxy"
    - "traefik.frontend.rule=Host:traefik.localhost"

  docker-frontend:
    container_name: docker-frontend
    build:
      context: ./frontend
    restart: always
    networks:
    - traefik
    ports:
    - "8080:80"
    volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "$PWD/frontend/html:/var/www/html"
